!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("redux")):"function"==typeof define&&define.amd?define(["redux"],t):"object"==typeof exports?exports["redux-rails"]=t(require("redux")):e["redux-rails"]=t(e.redux)}("undefined"!=typeof self?self:this,(function(e){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(a,o,function(t){return e[t]}.bind(null,o));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(t,r){t.exports=e},function(e,t,r){"use strict";r.r(t);let a=0;const o=({resourceConfig:e,config:t,defaultConfig:r={}})=>d(e.optimisticUpdateEnabled)?e.optimisticUpdateEnabled:d(t.resources.optimisticUpdateEnabled)?t.resources.optimisticUpdateEnabled:d(t.optimisticUpdateEnabled)?t.optimisticUpdateEnabled:!d(r.optimisticUpdateEnabled)||r.optimisticUpdateEnabled,s=({controller:e})=>"s"===e[e.length-1]?"collection":"member",i=({config:e,resource:t})=>{const r=e.resources[t].controller;return"collection"===s({controller:r})?"models":"attributes"},c=({config:e,resource:t})=>e.resources[t].idAttribute||"id",d=e=>"boolean"==typeof e,n=({config:e,store:t})=>"function"==typeof e?e(t):e;let u={};const l={SHOW:"GET",INDEX:"GET",CREATE:"POST",UPDATE:"PUT",DESTROY:"DELETE"},m=(e,t)=>`${e}=${encodeURIComponent(t)}`,f=(e,t)=>Array.isArray(t)?((e,t)=>t.map(t=>m(`${e}[]`,t)))(e,t):m(e,t),p=({baseUrl:e,controller:t,railsAction:r,data:a,queryParams:o={}})=>{const i=s({controller:t}),c=(e=>e.includes("/:id/"))(t),d=()=>c||"collection"===i&&"INDEX"!==r&&"CREATE"!==r?`/${a.id}`:"",n=((e={},t)=>{const r=Object.keys(e).filter(t=>void 0!==e[t]||null!==e[t]);return 0===r.length||"GET"!==l[t]?"":`?${r.map(t=>f(t,e[t])).join("&")}`})(o,r);let u;return u=c?`${e}${t}`.replace("/:id",d()):`${e}${t}${d()}`,`${u}${n}`},b=({store:e,resource:t,railsAction:r,error:a,id:o,cId:s,optimisticUpdateEnabled:i,reject:c})=>{const d={type:`${t}.${r}_ERROR`,error:a,id:o,cId:s},n="CREATE"===r;e.dispatch(d),["CREATE","UPDATE"].includes(r)&&i&&e.dispatch({type:`${t}.UNSET_OPTIMISTIC_DATA`,id:o,cId:s,destroy:n}),c(d)},E=({store:e,resource:t,config:r,data:i={},railsAction:d,controllerOverride:n,fetchParamsOverride:u,queryParamsOverride:m,resolve:f,reject:y})=>{const D=r.resources[t],A=D.baseUrl||r.baseUrl,h=n||D.controller,S=c({config:r,resource:t}),T=u||D.fetchParams||r.fetchParams,O=m||D.queryParams||r.queryParams,_=(({railsAction:e,resource:t,config:r,data:a,fetchParams:o={}})=>{const s=l[e],i=new Headers(o.headers||{});let c=Object.assign({},o,{method:s,headers:i});return"object"==typeof a&&"GET"!==s&&(c.body=JSON.stringify(a)),c})({railsAction:d,resource:t,data:i,config:r,fetchParams:T}),P=p({baseUrl:A,controller:h,railsAction:d,data:i,fetchParams:T,queryParams:O}),v=o({resourceConfig:D,config:r});let $;"CREATE"===d&&($=++a,e.dispatch({type:`${t}.ASSIGN_CID`,cId:$}),e.dispatch({type:`${t}.SET_LOADING`,cId:$})),["CREATE","UPDATE"].includes(d)&&v&&e.dispatch({type:`${t}.SET_OPTIMISTIC_DATA`,id:i.id,cId:$,data:i}),fetch(P,_).then(a=>{a.json().then(o=>{const c=o&&o[S]||i.id;if(!a.ok)return b({store:e,resource:t,railsAction:d,id:c,cId:$,optimisticUpdateEnabled:v,reject:y,error:o.error||{message:a.statusText}});(({store:e,resource:t,railsAction:r,id:a,cId:o,json:i,config:c,controller:d,resolve:n})=>{const u=`${t}.${r}_SUCCESS`,{response:l,metaData:m}=I({json:i,resource:t,config:c,resourceType:s({controller:d})}),f={cId:o,id:a,metaData:m,response:l,type:u};e.dispatch(f),n(f)})({store:e,resource:t,railsAction:d,id:c,cId:$,json:o,config:r,controller:h,optimisticUpdateEnabled:v,resolve:f})}).catch(r=>{const a=r&&r.toString&&r.toString();b({store:e,resource:t,railsAction:d,error:a,id:i.id,cId:$,optimisticUpdateEnabled:v,reject:y})})}).catch(r=>{b({store:e,resource:t,railsAction:d,error:r,id:i.id,cId:$,optimisticUpdateEnabled:v,reject:y})}).then(()=>(({resource:e})=>{const t=g({resource:e});t.shift(),t.length>0&&E(t[0])})({resource:t}))},g=({resource:e})=>(u[e]||(u[e]={queue:[]}),u[e].queue),I=({json:e,resource:t,config:r,resourceType:a})=>{const o=r.resources[t].parse,s=r.resources[t].setMetadata;let i,c={};switch(typeof o){case"object":{const t=o&&o[a];if(!t){i=e;break}i=t(e);break}case"function":i=o(e);break;default:i=e}switch(typeof s){case"object":{const t=s&&s[a];if(!t)break;c=t(e);break}case"function":c=s(e);break;default:c={}}return{response:i,metaData:c}},y=({action:e,config:t,fetchData:r,next:a,resource:o,resourceConfig:s})=>{const i=new Promise((e,a)=>{const i={resolve:e,reject:a,...r};(t.disableFetchQueueing||s.disableFetchQueueing)&&E(i),((e,t)=>{const r=g({resource:e});r.push(t),r.length<=1&&E(t)})(o,i)});return a(e),i};var D=e=>t=>r=>a=>{const o=n({config:e,store:t.getState()}),[s,i]=a.type.split("."),{data:c,controller:d,fetchParams:u}=a,{queryParams:m}=c||{},f={store:t,resource:s,config:o,data:c,railsAction:i,controllerOverride:d,fetchParamsOverride:u,queryParamsOverride:m},p=o.resources[s];return p&&l[i]?y({action:a,config:o,fetchData:f,next:r,resource:s,resourceConfig:p}):r(a)},A=r(0);const h={loading:!1,loadingError:void 0,__prevData:void 0},S=({id:e,cId:t,state:r})=>{let a,o;return(r.models&&r.models.slice(0)||[]).find(r=>(a=void 0!==r.id,o=void 0!==t,a&&r.id===e||o&&r.cId===t))},T=({id:e,cId:t,metaData:r,attributes:a={}})=>{let o={id:e,cId:t,attributes:{...a}};return Object.keys(o).forEach(e=>void 0===o[e]?delete o[e]:""),{...h,...r,...o}},O=({metaData:e,models:t=[]})=>({...h,...e,models:t}),_=({state:e,model:t})=>[...e.models||[],t],P=({id:e,cId:t,state:r,updatedModel:a})=>{let o,s;return(r.models&&r.models.slice(0)||[]).map(r=>(o=void 0!==r.id,s=void 0!==t,o&&r.id===e||s&&r.cId===t?a:r))},v=({id:e,data:t,metaData:r,state:a,cId:o,replaceAttributes:s=!0,replaceMeta:i=!0})=>{const c=S({id:e,cId:o,state:a});let d;return c?(d=s?t:{...c.attributes,...t},!o&&c.cId&&(o=c.cId),P({id:e,cId:o,state:a,updatedModel:T({id:e,cId:o,metaData:r,attributes:d})})):_({state:a,model:T({id:e,cId:o,metaData:r,attributes:t})})},$=({id:e,state:t})=>t.models.filter(t=>t.id!==e),U=({cId:e,state:t})=>t.models.filter(t=>t.cId!==e),j=({id:e,cId:t,state:r,queryParams:a})=>{const o=S({id:e,cId:t,state:r});return o?P({id:e,cId:t,state:r,updatedModel:T({id:e,cId:t,metaData:{loading:!0,queryParams:a},attributes:o.attributes})}):_({state:r,model:T({id:e,cId:t,metaData:{loading:!0,queryParams:a}})})},C=({id:e,cId:t,state:r,error:a})=>{const o=S({id:e,cId:t,state:r});return o||e?o?P({id:e,state:r,cId:t,updatedModel:T({...o,metaData:{loadingError:a,__prevData:o.__prevData}})}):_({state:r,model:T({id:e,metaData:{loadingError:a}})}):r.models.slice(0)},R=({config:e,resource:t})=>{const r=i({config:e,resource:t}),a="attributes"===r,o=e.resources[t]||{},s=c({config:e,resource:t});let d;return a?(d=o[r]?o[s]||o.attributes[s]:void 0,T({id:d,idAttribute:s,attributes:o.attributes})):O({models:(o.models||[]).map(e=>T({idAttribute:s,id:e[s],attributes:e}))})};var q=e=>{const t=n({config:e}),r={};return Object.keys(t.resources).forEach(e=>{r[e]=(r=R({config:t,resource:e}),a={})=>{const o=t.resources[e]||{},s="attributes"===i({config:t,resource:e}),d=c({config:t,resource:e}),{queryParams:n}=a.data||{};switch(a.type){case`${e}.INDEX`:{const{paginated:e}=o;return{...r,...O({metaData:{loading:!0,queryParams:n},models:e?r.models:[]})}}case`${e}.INDEX_SUCCESS`:{let{response:t,metaData:s}=a;const i=a.response[e]||a.response[e.toLowerCase()];if(!Array.isArray(a.response)){if(!i||!Array.isArray(i))return console.error("Response to INDEX actions must be of type array OR contain a top-level key matching the resource name with an array as the value. You can use the parse method(s) set in your config for this resource to transform returned data if needed."),{...r,...O({metaData:{loading:!1,loadingError:"Bad data received from server. INDEX calls expect an array."}})};t=i}if(o.paginated){const e=t.reduce((e,t)=>({...e,[t.id]:t}),{}),a=r.models.map(e=>e.attributes),o={};t=[...a.map(t=>e[t.id]?(o[t.id]=!0,e[t.id]):t),...t.filter(e=>!o[e.id])]}return{...r,...O({models:t.map(e=>T({id:e[d],attributes:e})),metaData:s})}}case`${e}.INDEX_ERROR`:{const{error:e}=a;return{...r,...O({metaData:{loading:!1,loadingError:e}})}}case`${e}.SHOW`:{const e=a.data||{},{id:t}=e;return s?T({metaData:{loading:!0,queryParams:n},attributes:r.attributes}):{...r,models:j({id:t,state:r,queryParams:n})}}case`${e}.SHOW_SUCCESS`:{const{id:e,response:t,metaData:o}=a,i=t;return s?T({id:e,metaData:o,attributes:{...r.attributes,...i}}):{...r,...O({models:v({id:e,data:i,state:r,metaData:{loading:!1,...o}})})}}case`${e}.SHOW_ERROR`:{const{id:e,error:t}=a;return s?T({id:e,attributes:{...r.attributes},metaData:{loadingError:t}}):{...r,models:C({state:r,id:e,error:t})}}case`${e}.ASSIGN_CID`:{const{cId:e}=a;return s?T({cId:e}):O({models:v({cId:e,state:r})})}case`${e}.CREATE_SUCCESS`:{const{cId:e,id:t,response:o,metaData:i}=a,c=o;return s?T({id:t,cId:e,attributes:{...r.attributes,...c},metaData:i}):O({models:v({data:c,state:r,id:t,cId:e,metaData:i})})}case`${e}.CREATE_ERROR`:{const{id:e,cId:t,error:o}=a;return s?T({id:e,cId:t,metaData:{loadingError:o}}):{...r,models:C({state:r,id:e,cId:t,error:o})}}case`${e}.UPDATE`:{const e=a.data||{},{id:t}=e,o=r.__prevData;return s?T({id:t,metaData:{loading:!0,__prevData:o},attributes:r.attributes}):{...r,models:j({id:t,state:r})}}case`${e}.UPDATE_SUCCESS`:{const{id:e,metaData:t,response:o}=a,i=o;return s?T({id:e,attributes:{...r.attributes,...i},metaData:t}):{...r,models:v({id:e,data:i,metaData:t,state:r,replaceAttributes:!1})}}case`${e}.UPDATE_ERROR`:{const{id:e,error:t}=a;return s?T({id:e,attributes:r.attributes,metaData:{loadingError:t}}):{...r,models:C({state:r,id:e,error:t})}}case`${e}.DESTROY`:{const e=(a.data||{}).id||r.id;return s?T({id:e,attributes:r.attributes,metaData:{loading:!0}}):{...r,models:j({idAttribute:d,id:e,state:r})}}case`${e}.DESTROY_SUCCESS`:{const{id:e}=a;return s?null:{...r,models:$({idAttribute:d,id:e,state:r})}}case`${e}.DESTROY_ERROR`:{const{id:e,error:t}=a;return s?{...r,loading:!1,loadingError:t}:{...r,models:C({state:r,id:e,idAttribute:d,error:t})}}case`${e}.SET_LOADING`:{const{id:e,cId:t}=a;return s?{...r,loading:!0,loadingError:void 0}:{...r,models:j({idAttribute:d,id:e,cId:t,state:r})}}case`${e}.SET_OPTIMISTIC_DATA`:{const{id:e,cId:t,data:o}=a,i=s?r:S({id:e,cId:t,state:r}),c={...i.attributes};let d,n={};return Object.keys(h).forEach(e=>{n[e]=i[e]}),d={...n,__prevData:c},s?T({id:e,cId:t,attributes:{...i.attributes,...o},metaData:d}):O({models:v({data:o,state:r,id:e,cId:t,metaData:d})})}case`${e}.UNSET_OPTIMISTIC_DATA`:{const{id:e,cId:t,destroy:o}=a,i=s?r:S({id:e,cId:t,state:r});return o&&s?null:o?{...r,models:U({cId:t,state:r})}:s?T({id:e,cId:t,attributes:i.__prevData}):O({models:v({data:i.__prevData,state:r,id:e,cId:t})})}default:{const o=t.resources[e];return o&&o.reducer?o.reducer(r,a):r}}}}),Object(A.combineReducers)(r)};var x={index:({resource:e,controller:t,queryParams:r})=>({type:`${e}.INDEX`,data:{queryParams:r},controller:t}),show:({id:e,resource:t,controller:r,queryParams:a})=>({type:`${t}.SHOW`,data:{id:e,queryParams:a},controller:r}),update:({id:e,attributes:t,resource:r,controller:a})=>({type:`${r}.UPDATE`,data:{id:e,...t},controller:a}),create:({resource:e,attributes:t,controller:r})=>({type:`${e}.CREATE`,data:t,controller:r}),destroy:({id:e,resource:t,controller:r})=>({type:`${t}.DESTROY`,data:{id:e},controller:r})},N=(...e)=>{const t=n({config:e[0]})||{};let r=Object.assign({},t,{resources:Object.assign({},t.resources)});return e.map(e=>{const r=n({config:e});if(!r.resources)return;const a={};return Object.keys(r.resources||{}).forEach(e=>{const s=r.resources[e];"baseUrl"===e&&"string"==typeof s||"optimisticUpdateEnabled"===e&&d(s)||(a[e]=Object.assign({},s,{baseUrl:s.baseUrl||r.resources.baseUrl||t.baseUrl,optimisticUpdateEnabled:o({resourceConfig:s,config:r,defaultConfig:t})}))}),a}).filter(e=>void 0!==e).forEach(e=>{Object.keys(e).forEach(t=>{let a=e[t];r.resources[t]=Object.assign({},a)})}),r};r.d(t,"apiReducer",(function(){return q})),r.d(t,"combineConfigs",(function(){return N})),r.d(t,"middleWare",(function(){return D})),r.d(t,"railsActions",(function(){return x}))}])}));